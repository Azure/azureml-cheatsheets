(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{101:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return c})),t.d(a,"metadata",(function(){return s})),t.d(a,"toc",(function(){return i})),t.d(a,"default",(function(){return p}));var r=t(3),n=t(7),o=(t(0),t(117)),c={title:"Data",description:"Guide to working with data in Azure ML.",keywords:["data","dataset","datastore"]},s={unversionedId:"cheatsheets/python/v1/data",id:"cheatsheets/python/v1/data",isDocsHomePage:!1,title:"Data",description:"Guide to working with data in Azure ML.",source:"@site/docs/cheatsheets/python/v1/data.md",sourceDirName:"cheatsheets/python/v1",slug:"/cheatsheets/python/v1/data",permalink:"/azureml-cheatsheets/docs/cheatsheets/python/v1/data",editUrl:"https://github.com/Azure/azureml-cheatsheets/tree/main/website/docs/cheatsheets/python/v1/data.md",version:"current",frontMatter:{title:"Data",description:"Guide to working with data in Azure ML.",keywords:["data","dataset","datastore"]},sidebar:"pythonSidebar",previous:{title:"Environment",permalink:"/azureml-cheatsheets/docs/cheatsheets/python/v1/environment"},next:{title:"Running Code in the Cloud",permalink:"/azureml-cheatsheets/docs/cheatsheets/python/v1/script-run-config"}},i=[{value:"Concepts",id:"concepts",children:[{value:"Datastore",id:"datastore",children:[]},{value:"Dataset",id:"dataset",children:[]}]},{value:"Get Datastore",id:"get-datastore",children:[{value:"Default datastore",id:"default-datastore",children:[]},{value:"Register datastore",id:"register-datastore",children:[]},{value:"Connect to datastore",id:"connect-to-datastore",children:[]},{value:"Link datastore to Azure Storage Explorer",id:"link-datastore-to-azure-storage-explorer",children:[]}]},{value:"Blob Datastore",id:"blob-datastore",children:[{value:"Upload to Blob Datastore",id:"upload-to-blob-datastore",children:[]},{value:"Download from Blob Datastore",id:"download-from-blob-datastore",children:[]},{value:"Via Storage Explorer",id:"via-storage-explorer",children:[]}]},{value:"Read from Datastore",id:"read-from-datastore",children:[{value:"DataReference",id:"datareference",children:[]}]},{value:"Create Dataset",id:"create-dataset",children:[{value:"From local data",id:"from-local-data",children:[]}]},{value:"Use Dataset",id:"use-dataset",children:[{value:"ScriptRunConfig",id:"scriptrunconfig",children:[]}]}],l={toc:i};function p(e){var a=e.components,t=Object(n.a)(e,["components"]);return Object(o.a)("wrapper",Object(r.a)({},l,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h2",{id:"concepts"},"Concepts"),Object(o.a)("p",null,"AzureML provides two basic assets for working with data:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"Datastore"),Object(o.a)("li",{parentName:"ul"},"Dataset")),Object(o.a)("h3",{id:"datastore"},"Datastore"),Object(o.a)("p",null,"Provides an interface for numerous Azure Machine Learning storage accounts."),Object(o.a)("p",null,"Each Azure ML workspace comes with a default datastore:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"from azureml.core import Workspace\nws = Workspace.from_config()\ndatastore = ws.get_default_datastore()\n")),Object(o.a)("p",null,"which can also be accessed directly from the ",Object(o.a)("a",{parentName:"p",href:"https://portal.azure.com"},"Azure Portal")," (under the same\nresource group as your Azure ML Workspace)."),Object(o.a)("p",null,"Datastores are attached to workspaces and are used to store connection information to Azure storage services so you can refer to them by name and don't need to remember the connection information and secret used to connect to the storage services."),Object(o.a)("p",null,"Use this class to perform management operations, including register, list, get, and remove datastores."),Object(o.a)("h3",{id:"dataset"},"Dataset"),Object(o.a)("p",null,"A dataset is a reference to data - either in a datastore or behind a public URL."),Object(o.a)("p",null,"Datasets provide enhaced capabilities including data lineage (with the notion of versioned datasets)."),Object(o.a)("h2",{id:"get-datastore"},"Get Datastore"),Object(o.a)("h3",{id:"default-datastore"},"Default datastore"),Object(o.a)("p",null,"Each workspace comes with a default datastore."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore = ws.get_default_datastore()\n")),Object(o.a)("h3",{id:"register-datastore"},"Register datastore"),Object(o.a)("p",null,"Connect to, or create, a datastore backed by one of the multiple data-storage options\nthat Azure provides. For example:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"Azure Blob Container"),Object(o.a)("li",{parentName:"ul"},"Azure Data Lake (Gen1 or Gen2)"),Object(o.a)("li",{parentName:"ul"},"Azure File Share"),Object(o.a)("li",{parentName:"ul"},"Azure MySQL"),Object(o.a)("li",{parentName:"ul"},"Azure PostgreSQL"),Object(o.a)("li",{parentName:"ul"},"Azure SQL"),Object(o.a)("li",{parentName:"ul"},"Azure Databricks File System")),Object(o.a)("p",null,"See the SDK for a comprehensive list of datastore types and authentication options:\n",Object(o.a)("a",{parentName:"p",href:"https://docs.microsoft.com/python/api/azureml-core/azureml.core.datastore(class)?view=azure-ml-py"},"Datastores (SDK)"),"."),Object(o.a)("h4",{id:"register-a-new-datastore"},"Register a new datastore"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"To register a store via an ",Object(o.a)("strong",{parentName:"p"},"account key"),":"),Object(o.a)("pre",{parentName:"li"},Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastores = Datastore.register_azure_blob_container(\n    workspace=ws,\n    datastore_name='<datastore-name>',\n    container_name='<container-name>',\n    account_name='<account-name>',\n    account_key='<account-key>',\n)\n"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"To register a store via a ",Object(o.a)("strong",{parentName:"p"},"SAS token"),":"),Object(o.a)("pre",{parentName:"li"},Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastores = Datastore.register_azure_blob_container(\n    workspace=ws,\n    datastore_name='<datastore-name>',\n    container_name='<container-name>',\n    account_name='<account-name>',\n    sas_token='<sas-token>',\n)\n")))),Object(o.a)("h3",{id:"connect-to-datastore"},"Connect to datastore"),Object(o.a)("p",null,"The workspace object ",Object(o.a)("inlineCode",{parentName:"p"},"ws")," has  access to its datastores via"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"ws.datastores: Dict[str, Datastore]\n")),Object(o.a)("p",null,"Any datastore that is registered to workspace can thus be accessed by name."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore = ws.datastores['<name-of-registered-datastore>']\n")),Object(o.a)("h3",{id:"link-datastore-to-azure-storage-explorer"},"Link datastore to Azure Storage Explorer"),Object(o.a)("p",null,"The workspace object ",Object(o.a)("inlineCode",{parentName:"p"},"ws")," is a very powerful handle when it comes to managing assets the\nworkspace has access to. For example, we can use the workspace to connect to a datastore\nin Azure Storage Explorer."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"from azureml.core import Workspace\nws = Workspace.from_config()\ndatastore = ws.datastores['<name-of-datastore>']\n")),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"For a datastore that was created using an ",Object(o.a)("strong",{parentName:"p"},"account key")," we can use:"),Object(o.a)("pre",{parentName:"li"},Object(o.a)("code",{parentName:"pre",className:"language-python"},"account_name, account_key = datastore.account_name, datastore.account_key\n"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"For a datastore that was created using a ",Object(o.a)("strong",{parentName:"p"},"SAS token")," we can use:"),Object(o.a)("pre",{parentName:"li"},Object(o.a)("code",{parentName:"pre",className:"language-python"},"sas_token = datastore.sas_token\n")))),Object(o.a)("p",null,"The account_name and account_key can then be used directly in Azure Storage Explorer to\nconnect to the Datastore."),Object(o.a)("h2",{id:"blob-datastore"},"Blob Datastore"),Object(o.a)("p",null,"Move data to and from your ",Object(o.a)("a",{parentName:"p",href:"https://docs.microsoft.com/python/api/azureml-core/azureml.data.azure_storage_datastore.azureblobdatastore?view=azure-ml-py"},"AzureBlobDatastore")," object ",Object(o.a)("inlineCode",{parentName:"p"},"datastore"),"."),Object(o.a)("h3",{id:"upload-to-blob-datastore"},"Upload to Blob Datastore"),Object(o.a)("p",null,"The AzureBlobDatastore provides APIs for data upload:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore.upload(\n    src_dir='./data',\n    target_path='<path/on/datastore>',\n    overwrite=True,\n    )\n")),Object(o.a)("p",null,"Alternatively, if you are working with multiple files in different locations you can use"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore.upload_files(\n    files, # List[str] of absolute paths of files to upload\n    target_path='<path/on/datastore>',\n    overwrite=False,\n    )\n")),Object(o.a)("h3",{id:"download-from-blob-datastore"},"Download from Blob Datastore"),Object(o.a)("p",null,"Download the data from the blob container to the local file system."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore.download(\n    target_path, # str: local directory to download to\n    prefix='<path/on/datastore>',\n    overwrite=False,\n    )\n")),Object(o.a)("h3",{id:"via-storage-explorer"},"Via Storage Explorer"),Object(o.a)("p",null,"Azure Storage Explorer is free tool to easily manage your Azure cloud storage\nresources from Windows, macOS, or Linux. Download it from ",Object(o.a)("a",{parentName:"p",href:"https://azure.microsoft.com/features/storage-explorer/"},"here"),"."),Object(o.a)("p",null,"Azure Storage Explorer gives you a (graphical) file exporer, so you can literally drag-and-drop\nfiles into and out of your datastores."),Object(o.a)("p",null,"See ",Object(o.a)("a",{parentName:"p",href:"#link-datastore-to-azure-storage-explorer"},'"Link datastore to Azure Storage Explorer"'),"\nabove for more details."),Object(o.a)("h2",{id:"read-from-datastore"},"Read from Datastore"),Object(o.a)("p",null,"Reference data in a ",Object(o.a)("inlineCode",{parentName:"p"},"Datastore")," in your code, for example to use in a remote setting."),Object(o.a)("h3",{id:"datareference"},"DataReference"),Object(o.a)("p",null,"First, connect to your basic assets: ",Object(o.a)("inlineCode",{parentName:"p"},"Workspace"),", ",Object(o.a)("inlineCode",{parentName:"p"},"ComputeTarget")," and ",Object(o.a)("inlineCode",{parentName:"p"},"Datastore"),"."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"from azureml.core import Workspace\nws: Workspace = Workspace.from_config()\ncompute_target: ComputeTarget = ws.compute_targets['<compute-target-name>']\nds: Datastore = ws.get_default_datastore()\n")),Object(o.a)("p",null,"Create a ",Object(o.a)("inlineCode",{parentName:"p"},"DataReference"),", either as mount:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"data_ref = ds.path('<path/on/datastore>').as_mount()\n")),Object(o.a)("p",null,"or as download:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"data_ref = ds.path('<path/on/datastore>').as_download()\n")),Object(o.a)("div",{className:"admonition admonition-info alert alert--info"},Object(o.a)("div",{parentName:"div",className:"admonition-heading"},Object(o.a)("h5",{parentName:"div"},Object(o.a)("span",{parentName:"h5",className:"admonition-icon"},Object(o.a)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.a)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(o.a)("div",{parentName:"div",className:"admonition-content"},Object(o.a)("p",{parentName:"div"},"To mount a datastore the workspace need to have read and write access to the underlying storage. For readonly datastore ",Object(o.a)("inlineCode",{parentName:"p"},"as_download")," is the only option. "))),Object(o.a)("h4",{id:"consume-datareference-in-scriptrunconfig"},"Consume DataReference in ScriptRunConfig"),Object(o.a)("p",null,"Add this DataReference to a ScriptRunConfig as follows."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"config = ScriptRunConfig(\n    source_directory='.',\n    script='script.py',\n    arguments=[str(data_ref)],               # returns environment variable $AZUREML_DATAREFERENCE_example_data\n    compute_target=compute_target,\n)\n\nconfig.run_config.data_references[data_ref.data_reference_name] = data_ref.to_config()\n")),Object(o.a)("p",null,"The command-line argument ",Object(o.a)("inlineCode",{parentName:"p"},"str(data_ref)")," returns the environment variable ",Object(o.a)("inlineCode",{parentName:"p"},"$AZUREML_DATAREFERENCE_example_data"),".\nFinally, ",Object(o.a)("inlineCode",{parentName:"p"},"data_ref.to_config()")," instructs the run to mount the data to the compute target and to assign the\nabove environment variable appropriately."),Object(o.a)("h4",{id:"without-specifying-argument"},"Without specifying argument"),Object(o.a)("p",null,"Specify a ",Object(o.a)("inlineCode",{parentName:"p"},"path_on_compute")," to reference your data without the need for command-line arguments."),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"data_ref = ds.path('<path/on/datastore>').as_mount()\ndata_ref.path_on_compute = '/tmp/data'\n\nconfig = ScriptRunConfig(\n    source_directory='.',\n    script='script.py',\n    compute_target=compute_target,\n)\n\nconfig.run_config.data_references[data_ref.data_reference_name] = data_ref.to_config()\n")),Object(o.a)("h2",{id:"create-dataset"},"Create Dataset"),Object(o.a)("h3",{id:"from-local-data"},"From local data"),Object(o.a)("h4",{id:"upload-to-datastore"},"Upload to datastore"),Object(o.a)("p",null,"To upload a local directory ",Object(o.a)("inlineCode",{parentName:"p"},"./data/"),":"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore = ws.get_default_datastore()\ndatastore.upload(src_dir='./data', target_path='<path/on/datastore>', overwrite=True)\n")),Object(o.a)("p",null,"This will upload the entire directory ",Object(o.a)("inlineCode",{parentName:"p"},"./data")," from local to the default datastore associated\nto your workspace ",Object(o.a)("inlineCode",{parentName:"p"},"ws"),"."),Object(o.a)("h4",{id:"create-dataset-from-files-in-datastore"},"Create dataset from files in datastore"),Object(o.a)("p",null,"To create a dataset from a directory on a datastore at ",Object(o.a)("inlineCode",{parentName:"p"},"<path/on/datastore>"),":"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python"},"datastore = ws.get_default_datastore()\ndataset = Dataset.File.from_files(path=(datastore, '<path/on/datastore>'))\n")),Object(o.a)("h2",{id:"use-dataset"},"Use Dataset"),Object(o.a)("h3",{id:"scriptrunconfig"},"ScriptRunConfig"),Object(o.a)("p",null,"To reference data from a dataset in a ScriptRunConfig you can either mount or download the\ndataset using:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"dataset.as_mount(path_on_compute)")," : mount dataset to a remote run"),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"dataset.as_download(path_on_compute)")," : download the dataset to a remote run")),Object(o.a)("p",null,Object(o.a)("strong",{parentName:"p"},"Path on compute")," Both ",Object(o.a)("inlineCode",{parentName:"p"},"as_mount")," and ",Object(o.a)("inlineCode",{parentName:"p"},"as_download")," accept an (optional) parameter ",Object(o.a)("inlineCode",{parentName:"p"},"path_on_compute"),".\nThis defines the path on the compute target where the data is made available."),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"If ",Object(o.a)("inlineCode",{parentName:"li"},"None"),", the data will be downloaded into a temporary directory."),Object(o.a)("li",{parentName:"ul"},"If ",Object(o.a)("inlineCode",{parentName:"li"},"path_on_compute")," starts with a ",Object(o.a)("inlineCode",{parentName:"li"},"/")," it will be treated as an ",Object(o.a)("strong",{parentName:"li"},"absolute path"),". (If you have\nspecified an absolute path, please make sure that the job has permission to write to that directory.)"),Object(o.a)("li",{parentName:"ul"},"Otherwise it will be treated as relative to the working directory")),Object(o.a)("p",null,"Reference this data in a remote run, for example in mount-mode:"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python",metastring:'title="run.py"',title:'"run.py"'},"arguments=[dataset.as_mount()]\nconfig = ScriptRunConfig(source_directory='.', script='train.py', arguments=arguments)\nexperiment.submit(config)\n")),Object(o.a)("p",null,"and consumed in ",Object(o.a)("inlineCode",{parentName:"p"},"train.py"),":"),Object(o.a)("pre",null,Object(o.a)("code",{parentName:"pre",className:"language-python",metastring:'title="train.py"',title:'"train.py"'},'import sys\ndata_dir = sys.argv[1]\n\nprint("===== DATA =====")\nprint("DATA PATH: " + data_dir)\nprint("LIST FILES IN DATA DIR...")\nprint(os.listdir(data_dir))\nprint("================")\n')),Object(o.a)("p",null,"For more details: ",Object(o.a)("a",{parentName:"p",href:"script-run-config"},"ScriptRunConfig")))}p.isMDXComponent=!0},117:function(e,a,t){"use strict";t.d(a,"a",(function(){return m}));var r=t(0),n=t.n(r);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function c(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?c(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var l=n.a.createContext({}),p=function(e){var a=n.a.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.a.createElement(n.a.Fragment,{},a)}},u=n.a.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,b=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return t?n.a.createElement(b,s(s({ref:a},l),{},{components:t})):n.a.createElement(b,s({ref:a},l))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,c=new Array(o);c[0]=u;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,c[1]=s;for(var l=2;l<o;l++)c[l]=t[l];return n.a.createElement.apply(null,c)}return n.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);